{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./src/config.js","webpack:///./src/utils.js","webpack:///./src/main.js"],"names":["root","factory","exports","module","define","amd","a","i","window","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","config","version","protocol","serverIP","httpsServerPort","path","sentryGlobalConfig","enable","http","xhr","vue","typeDict","diy","promise","polyfill","obj","replacement","orig","__sentry__","__orig__","isFunction","fn","hasKey","extend","obj1","obj2","assign","APIKEY","Sentry","constructor","options","this","apikey","init","warn","commonModel","CommonModel","xhrModel","XHRModel","httpModel","HttpModel","windowModel","WindowModel","install","errorType","valid","callback","mergeOptions","server","installVuePlugin","Vue","vuePluginModel","VuePluginModel","vuePlugin","send","message","toString","type","confog","typeDoct","metaData","stack","addErrorEventListener","push","_this","addEventListener","errorEvent","len","length","commonMsg","getCommonReportMessage","url","map","item","reportParams","JSON","stringify","Image","src","encodeURIComponent","location","href","title","document","userAgent","navigator","super","formatComponentName","vm","$root","_isVue","$options","_componentTag","__file","_oldOnError","errorHandler","error","info","vueMessage","_errorMessageForReport","componentName","lifecycleHook","target","colno","lineno","nodeName","toLocaleLowerCase","pathFormatter","reverse","join","resourceUrl","outerHTML","outHTML","instrumentBreadcrumbs","wrap","func","_before","what","isUndefined","isFuntion","undefined","__sentry_wrapper__","e","wrapped","args","arguments","deep","apply","_ignoreNextError","captureErrorRequest","method","data","requestUrl","response","statusCode","status_code","test","indexOf","wrapProp","prop","mechanism","function","handler","xhrproto","XMLHttpRequest","origOpen","isString","_globalkey","__sentry_xhr_","origSend","onreadystatechangeHandler","readyState","status","category","props","j","onreadystatechange"],"mappings":"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","file":"sentry.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// 配置文件\n// @author muronggoudan\n// @date 2018-07-20\n\nexport default {\n\n  // 版本信息\n  // 用于平台信息展示兼容\n\tversion: '1.0.0',\n\t\n\tprotocol: 'https',\n\t\n\tserverIP: '10.35.93.100',\n\t\n\thttpsServerPort: '8090',\n  \n  // 错误上报路径\n\tpath: '/overseaFE/record/save',\n  \n  // 模块默认使能开关\n\tsentryGlobalConfig: {\n\t\tenable:   true,\n\t\twindow:   true,\n\t\thttp:     true,\n\t\txhr:      true,\n\t\tvue:      true,\n\t},\n  \n  // 上报错误类型字典\n\ttypeDict: {\n\t\tdiy:      '000',\n\t\twindow:   '001',\n\t\thttp:     '002',\n\t\txhr:      '003',\n\t\tvue:      '004',\n\t\tpromise:  '005',\n  }\n  \n}","// 工具类\n// @author muronggoudan\n// @date 2018-07-20\n\nimport config from './config';\n\n// 上报方法\nexport function report(url, message) {\n  const reportParams = JSON.stringify(message);\n  const img4Report = new Image();\n  img4Report.src = encodeURIComponent(url + reportParams);\n}\n\nexport function polyfill(obj, name, replacement) {\n\tif (obj === null) return;\n  \n  const orig = obj[name];\n  obj[name] = replacement(orig);\n  obj[name].__sentry__ = true;\n  obj[name].__orig__ = orig;\n}\n\n// 判断是不是function\nexport function isFunction(fn) {\n\treturn typeof fn === 'function';\n}\n\n// 判断是不是undefined\nexport function isUndefined(what) {\n\treturn what === void 0;\n}\n\n// 判断是不是string\nexport function isString(what) {\n\treturn Object.prototype.toString.call(what) === '[object String]';\n}\n\n// hasOwnProperty\nexport function hasKey(object, key) {\n\treturn Object.prototype.hasOwnProperty.call(object, key);\n}\n\n// 格式化路径\nexport function pathFormatter(path) {\n\treturn path.map((item) => {\n  \tif (window === item) return 'window';\n    \n    const nodeName = item.nodeName || '';\n    return nodeName.toLocaleLowerCase();\n  });\n}\n\n// 简化版extend\nexport function extend(obj1, obj2) {\n\treturn Object.assign({}, obj1, obj2);\n}\n\n// log\nexport function log(message) {\n  console.log.call(console, `[Sentry Log] : ${message}`);\n}\n\n// warn\nexport function warn(message) {\n  console.warn.call(console, `[Sentry Warning] : ${message}`);\n}\n\n// error\nexport function error(message) {\n  console.error.call(console, `[Sentry Error] : ${message}`);\n}\n","// Sentry 类实现\n// @author muronggoudan\n// @date 2018-07-20\n\nimport {\n\treport,\n\tpolyfill,\n\tisFunction,\n\tisUndefined,\n\tisString,\n\thasKey,\n\tpathFormatter,\n\textend,\n} from './utils';\n\nimport config from './config';\n\nlet APIKEY = null;\n\nclass Sentry {\n\n  static server = `${config.protocol}://${config.serverIP}:${config.httpsServerPort}`;\n  static path = config.path;\n  static enable;\n\n\tconstructor (options = {}) {\n\t\tthis.options = options;\n\t\t\n\t\t// apikey特殊处理\n\t\t// @TODO 健壮性校验\n\t\tif (!options.apikey) {\n\t\t\twarn('apikey缺失, 无法开启监控');\n\t\t\treturn;\n\t\t}\n\t\n\t\tAPIKEY = options.apikey;\n\t\t\n\t\tthis.init();\n\t}\n\t\n\tinit () {\n\t\n\t\tconst commonModel = new CommonModel();\n\t\tconst xhrModel = new XHRModel();\n\t\tconst httpModel = new HttpModel();\n\t\tconst windowModel = new WindowModel();\n\t\t\n\t\t// window 模块安装\n\t\tcommonModel.install(\n\t\t\twindowModel.errorType,\n\t\t\twindowModel.valid,\n\t\t\twindowModel.callback\n\t\t);\n\t\t\t\n\t\t// http 模块安装\n\t\tcommonModel.install(\n\t\t\thttpModel.errorType,\n\t\t\thttpModel.valid,\n\t\t\thttpModel.callback\n\t\t);\n\t\n\t\t// xhr 模块\n\t\txhrModel.init();\n\t\t\n  }\n  \n  mergeOptions (options) {\n    // @TODO 严格校验\n\n    if (options.server) {\n      this.server = options.server;\n    }\n\n    if (options.path) {\n      this.path = options.path;\n    }\n\n    if (options.module) {\n      this.enable = extend(config.sentryGlobalConfig, options.module);\n    } else {\n      this.enable = config.sentryGlobalConfig;\n    }\n  }\n\t\n\t// 安装Vue监听插件\n\tinstallVuePlugin (Vue) {\n\t\tconst vuePluginModel = new VuePluginModel();\n\t\tvuePluginModel.vuePlugin(Vue, vuePluginModel.send);\n\t}\n \t\n\t// 主动上报错误\n\tsend (message) {\n\t\tif (!message) {\n\t\t\twarn('上报失败, 参数为空');\n\t\t\treturn;\n\t\t}\n\t\n\t\t// @TODO 普通对象校验不严谨\n\t\tif ('[object Object]' !== Object.prototype.toString.call(message)) {\n\t\t\twarn('上报失败, 参数必须为普通对象');\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis.commonModel.send({\n\t\t\ttype: confog.typeDoct.diy,\n\t\t\tmetaData: message,\n\t\t});\n  }\n  \n}\n\n\nclass CommonModel {\n\t\n\tconstructor () {\n\t\t// 捕获不同类型多错误\n\t\tthis.stack = [];\n\t\tthis.addErrorEventListener();\n\t}\n\t\n\t// 安装\n\tinstall (errorType, valid, callback) {\n\t\tthis.stack.push({\n\t\t\ttype: errorType,\n\t\t\tvalid,\n\t\t\tcallback,\n\t\t});\n\t}\n\t\t\t\n\t// 错误监听\n\taddErrorEventListener () {\n\t\tconst _this = this;\n\t\t\n\t\t// DOM3级以及Opera部分错误类型不会冒泡 需要在捕获阶段获取\n\t\twindow.addEventListener('error', (errorEvent) => {\n\t\t\n\t\t\tlet i = 0,\n\t\t\tlen = _this.stack.length;\n\t\t\t\t\n\t\t\tfor (; i < len; i ++) {\n\t\t\t\tif (_this.stack[i].valid(errorEvent)) {\n\t\t\t\t\n\t\t\t\t\t_this.stack[i].callback.call(this, errorEvent);\n\t\t\t\t\t\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// 未捕获错误\n\t\t\t// Uncaught Error\n\t\t\t// @TODO 需要特殊处理\n\t\t\t\n\t\t}, true);\n\t}\n  \n  send (message) {\n    // @TODO 上报评率和条数控制\n    \n    const commonMsg = this.getCommonReportMessage();\n    const url = Sentry.server + Sentry.path;\n    message = [message].map((item) => {\n    \treturn extend(item, commonMsg);\n    });\n    \n    return report.call(this, url, message);\n  }\n  \n  getCommonReportMessage () {\n  \tconst apikey = APIKEY;\n    const version = config.version;\n    const url = window.location ? window.location.href ? window.location.href : '' : '';\n    const title = window.document ? window.document.title ? window.document.title : '' : '';\n    const userAgent = window.navigator ? window.navigator.userAgent ? window.navigator.userAgent : '' : '';\n    \n    return {\n    \tapikey,\n      title,\n      url,\n      version,\n      userAgent,\n    };\n  }\n\n}\n\n// Vue 插件模块\n// @TODO 传入到Vue类型鉴别\nclass VuePluginModel extends CommonModel {\n\n\tconstructor () {\n  \tsuper();\n  }\n\n\t// 格式化组件名称\n  formatComponentName (vm) {\n  \tif (vm.$root === vm) {\n    \treturn 'root instance';\n    }\n    \n    let name = vm._isVue ? vm.$options.name || vm.$options._componentTag : vm.name;\n    \n    return (\n    \t(name ? 'component <' + name + '>' : 'anonymous component') + \n      (vm._isVue && vm.$options.__file ? ' at ' + vm.$options.__file : '')\n    );\n  }\n  \n  vuePlugin (Vue, callback) {\n  \tconst _this = this;\n    \n    if (!Vue || !Vue.config) return;\n    \n    const _oldOnError = Vue.config.errorHandler;\n    Vue.config.errorHandler = function VueErrorHandler (error, vm, info) {\n      \n    \tlet vueMessage = {\n      \tmessage: error.message,\n        stack: error.stack,\n      };\n      \n      let _errorMessageForReport = {\n      \ttype: config.typeDict.vue,\n        vueMessage,\n        componentName: '',\n        lifecycleHook: null,\n      };\n      \n      // vm 和生命周期钩子不一定总是可用\n      if (Object.prototype.toString.call(vm) === '[object Object]') {\n      \t_errorMessageForReport.componentName = _this.formatComponentName(vm);\n      }\n      \n      if (typeof info !== 'undefined') {\n      \t_errorMessageForReport.lifecycleHook = info;\n      }\n      \n      // 兼容旧方法\n      if (typeof _oldOnError === 'function') {\n      \t_oldOnError.call(_this, error, vm, info);\n      }\n      \n      _this.send(_errorMessageForReport);\n      \n    };\n  }\n\n}\n\n// window错误模块\nclass WindowModel extends CommonModel {\n\n\tconstructor () {\n  \tsuper();\n    this.errorType = 'WindowError';\n  }\n  \n  // 目前demo校验 onerror可捕获多错误target都是window\n  // 后续健壮性继续考察\n  valid (errorEvent) {\n  \treturn errorEvent.target === window;\n  }\n  \n  callback (errorEvent) {\n  \tlet stack = {};\n    \n    if (errorEvent.error) {\n    \tstack.stack = errorEvent.error.stack || 'no stack';\n      stack.name = errorEvent.error.name || 'no name';\n    }\n    \n    const _errorMessageForReport = {\n    \ttype: config.typeDict.window,\n      colno: errorEvent.colno || 0,\n      lineno: errorEvent.lineno || 0,\n      message: errorEvent.message || 'no message',\n      stack,\n    };\n    \n    this.send(_errorMessageForReport);\n  }\n}\n\n// 资源请求模块\nclass HttpModel extends CommonModel {\n\n\tconstructor () {\n  \tsuper();\n    this.errorType = 'ResourceError';\n  }\n  \n  // 目前无法确切判断资源引用对象是谁\n  valid (errorEvent) {\n  \treturn errorEvent.target !== window;\n  }\n  \n  callback (errorEvent) {\n    \n  \tconst type = config.typeDict.http;\n    const path = pathFormatter(errorEvent.path).reverse().join(' > ');\n    const target = errorEvent.target.nodeName.toLocaleLowerCase();\n    const resourceUrl = errorEvent.target.src;\n    const outerHTML = errorEvent.target.outHTML;\n    \n    const _errorMessageForReport = {\n    \ttype,\n      path,\n      target,\n      resourceUrl,\n      outerHTML,\n    };\n    \n    this.send(_errorMessageForReport);\n  }\n  \n}\n\n// Promise模块\n// 未处理的catch错误\nclass Promise extends CommonModel {\n  constructor () {\n    spuer();\n    this.install();\n  }\n\n  install () {\n    window.addEventListener('unhandledrejection', (errorEvent) => {\n        this.callback(errorEvent);\n    });\n  }\n\n  callback () {\n    const type = config.typeDict.promise;\n    const rejectionReason = errorEvent.reason;\n    const rejectionDetail = errorEvent.toString();\n\n    const _errorMessageForReport = {\n        type,\n      rejectionReason,\n      rejectionDetail,\n    };\n\n    this.send(_errorMessageForReport);\n  }\n}\n\n// xhr模块\nclass XHRModel extends CommonModel {\n\n\tconstructor () {\n  \tsuper();\n  }\n  \n  init () {\n  \tthis.instrumentBreadcrumbs();\n  }\n  \n  wrap (options, func, _before) {\n  \tconst _this = this;\n    \n    // 非函数单参数 返回options本身\n    if (isUndefined(func) && !isFuntion(options)) {\n    \treturn options;\n    }\n    \n    // 函数单参数 封装函数\n    if (isFunction(options)) {\n    \tfunc = options;\n      options = undefined;\n    }\n    \n    if (!isFunction(func)) {\n    \treturn func;\n    }\n    \n    // 避免二次封装\n    try {\n    \tif (func.__sentry__) {\n      \treturn func;\n      }\n      \n      if (func.__sentry_wrapper__) {\n      \treturn func.__sentry_wrapper__;\n      }\n    } catch (e) {\n    \treturn func;\n    }\n    \n    // 返回封装函数\n    function wrapped () {\n    \tlet args = [],\n        i = arguments.length,\n        // 深层封装 除非制定deep = false\n        deep = !options || (options && options.deep !== false);\n      \n      // before 钩子函数\n      if (_before && isFunction(_before)) {\n      \t_before.apply(this, arguments);\n      }\n      \n      while (i--) args[i] = deep ? _this.wrap(options, arguments[i]) : arguments[i];\n      \n      try {\n      \treturn func.apply(this, args);\n      } catch (e) {\n      \t_this._ignoreNextError();\n        \n        // 手动捕获一个异常并且发送给平台\n        // 目前函数内部细节比较多 专注捕获业务代码本身\n        throw e;\n      }\n    }\n    \n    // 代理func函数上以及原型链上多属性\n    for (var property in func) {\n    \tif (hasKey(func, property)) {\n      \twrapped[property] = func[property];\n      }\n    }\n    \n    wrapped.prototype = func.prototype;\n    \n    // 将封装函数赋值给 _sentry_wrapper__\n    func.__sentry_wrapper__ = wrapped;\n    \n    // 是否封装过多标志位\n    wrapped.__sentry__ = true;\n    // 储存原函数\n    wrapped.__orig__ = func;\n    \n    return wrapped;\n  }\n\n  captureErrorRequest (obj) {\n    // @TODO 相应时间\n    // const crumb = extend({\n    //   timestamp: now() / 1000\n    // },\n    // obj\n    // );\n    const type = config.typeDict.xhr;\n    const method = obj.data.method;\n    const requestUrl = obj.data.url;\n    const response = obj.data.response;\n    const statusCode = obj.data.status_code;\n\n    // 过滤4|5开头的错误\n    // 需要过滤掉send接口 否则如果send接口不通 会造成无限递归\n    // @TODO 开放接口 自定义状态码\n    if (/^4|^5/.test(statusCode.toString()) && requestUrl.indexOf(config.path) === -1) {\n      this.send({\n        type,\n        method,\n        requestUrl,\n        response,\n        statusCode,\n      })\n    }\n  }\n\n  instrumentBreadcrumbs () {\n    const _this = this;\n\n    function wrapProp(prop, xhr) {\n      if (prop in xhr && isFunction([xhr[prop]])) {\n        polyfill(xhr, prop, function (orig) {\n          return _this.wrap({\n            mechanism: {\n              type: 'istrument',\n              data: {\n                function: prop,\n                handler: (orig && orig.name) || '<anonymous>',\n              }\n            }\n          },\n          orig\n          );\n        });\n      }\n    }\n\n    if ('XMLHttpRequest' in window) {\n      const xhrproto = window.XMLHttpRequest && window.XMLHttpRequest.prototype;\n      \n      // 代理open方法\n      polyfill(\n        xhrproto,\n        'open',\n        function (origOpen) {\n          return function (method, url) {\n            if (isString(url) && url.indexOf(_this._globalkey) === -1) {\n              this.__sentry_xhr_ = {\n                method,\n                url,\n                status_code: null,\n              };\n            }\n\n            return origOpen.apply(this, arguments);\n          };\n        }\n      );\n\n      // 代理send方法\n      polyfill(\n        xhrproto,\n        'send',\n        function (origSend) {\n          return function () {\n            let xhr = this;\n            function onreadystatechangeHandler() {\n              if (xhr.__sentry_xhr_ && xhr.readyState === 4) {\n                try {\n                  xhr.__sentry_xhr_.status_code = xhr.status;\n                  xhr.__sentry_xhr_.response = xhr.response;\n                } catch (e) {\n                  // do nothing\n                }\n\n                _this.captureErrorRequest({\n                  type: 'http',\n                  category: 'xhr',\n                  data: xhr.__sentry_xhr_\n                });\n              }\n            }\n\n            const props = ['onload', 'onerror', 'onprogress'];\n\n            for (let j = 0; j < props.length; j ++) {\n              wrapProp(props[j], xhr);\n            }\n\n            if ('onreadystatechange' in xhr && isFunction(xhr.onreadystatechange)) {\n              polyfill(\n                xhr,\n                'onreadystatechange',\n                function (orig) {\n                  return _this.wrap({\n                    mechanism: {\n                      type: 'instrument',\n                      data: {\n                        function: 'onreadystatechange',\n                        handler: (orig && orig.name) || '<anonymous>',\n                      }\n                    }\n                  },\n                  orig,\n                  onreadystatechangeHandler\n                  );\n                }\n              );\n            } else {\n              xhr.onreadystatechange = onreadystatechangeHandler;\n            }\n\n            return origSend.apply(this, arguments);\n          };\n        }\n      ) \n    }\n  }\n}\n \nexport {\n  Sentry\n}\n"],"sourceRoot":""}