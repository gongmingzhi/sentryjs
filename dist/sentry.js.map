{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./src/config.js","webpack:///./src/utils.js","webpack:///./src/main.js"],"names":["root","factory","exports","module","define","amd","a","i","window","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","config","version","protocol","server","httpsServerPort","path","sentryGlobalConfig","enable","http","xhr","promise","typeDict","diy","vue","polyfill","obj","replacement","orig","__sentry__","__orig__","isFunction","fn","hasKey","extend","obj1","obj2","assign","warn","message","console","Sentry","constructor","options","this","mergeOptions","init","commonModel","httpModel","windowModel","CommonModel","HttpModel","WindowModel","XHRModel","PromiseModel","install","errorType","valid","callback","apikey","installVuePlugin","Vue","vuePluginModel","VuePluginModel","vuePlugin","send","isPlainObject","type","confog","typeDoct","metaData","stack","addErrorEventListener","push","_this","addEventListener","errorEvent","len","length","commonMsg","getCommonReportMessage","url","map","item","reportParams","JSON","stringify","Image","src","encodeURIComponent","location","href","title","document","userAgent","navigator","super","formatComponentName","vm","$root","_isVue","$options","_componentTag","__file","_oldOnError","errorHandler","error","info","vueMessage","_errorMessageForReport","componentName","lifecycleHook","toString","target","colno","lineno","nodeName","toLocaleLowerCase","pathFormatter","reverse","join","resourceUrl","outerHTML","outHTML","rejectionReason","reason","promiseDetail","returnValue","timeStamp","instrumentBreadcrumbs","wrap","func","_before","what","isUndefined","isFuntion","undefined","__sentry_wrapper__","e","wrapped","args","arguments","deep","apply","_ignoreNextError","captureErrorRequest","method","data","requestUrl","response","statusCode","status_code","test","indexOf","wrapProp","prop","mechanism","function","handler","xhrproto","XMLHttpRequest","origOpen","isString","_globalkey","__sentry_xhr_","origSend","onreadystatechangeHandler","readyState","status","category","props","j","onreadystatechange"],"mappings":"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","file":"sentry.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// 配置文件\n// @author muronggoudan\n// @date 2018-07-20\n\nexport default {\n\n  // 版本信息\n  // 用于平台信息展示兼容\n\tversion: '1.0.1',\n  \n  // 平台协议\n\tprotocol: 'https',\n  \n  // 平台ip\n\tserver: '10.35.93.100',\n  \n  // 平台端口\n\thttpsServerPort: '8090',\n  \n  // 错误上报路径\n\tpath: '/overseaFE/record/save',\n  \n  // 模块默认使能开关\n\tsentryGlobalConfig: {\n    enable:   true,\n\t\twindow:   true,\n\t\thttp:     true,\n\t\txhr:      true,\n    promise:  true,\n\t},\n  \n  // 上报错误类型字典\n\ttypeDict: {\n\t\tdiy:      '000',\n\t\twindow:   '001',\n\t\thttp:     '002',\n\t\txhr:      '003',\n\t\tvue:      '004',\n\t\tpromise:  '005',\n  }\n  \n}","// 工具类\n// @author muronggoudan\n// @date 2018-07-20\n\nimport config from './config';\n\n// 上报信息工具方法\nexport function report(url, message) {\n  const reportParams = JSON.stringify(message);\n  const img4Report = new Image();\n  img4Report.src = encodeURIComponent(url + reportParams);\n}\n\nexport function polyfill(obj, name, replacement) {\n\tif (obj === null) return;\n  \n  const orig = obj[name];\n  obj[name] = replacement(orig);\n  obj[name].__sentry__ = true;\n  obj[name].__orig__ = orig;\n}\n\n// 判断是不是function\nexport function isFunction(fn) {\n\treturn typeof fn === 'function';\n}\n\n// 判断是不是undefined\nexport function isUndefined(what) {\n\treturn what === void 0;\n}\n\n// 判断是不是string\nexport function isString(what) {\n\treturn Object.prototype.toString.call(what) === '[object String]';\n}\n\nexport function isPlainObject(what) {\n\treturn Object.prototype.toString.call(what) === '[object Object]';\n}\n\n// hasOwnProperty\nexport function hasKey(object, key) {\n\treturn Object.prototype.hasOwnProperty.call(object, key);\n}\n\n// 格式化路径\nexport function pathFormatter(path) {\n\treturn path.map((item) => {\n  \tif (window === item) return 'window';\n    \n    const nodeName = item.nodeName || '';\n    return nodeName.toLocaleLowerCase();\n  });\n}\n\n// 简化版extend\nexport function extend(obj1, obj2) {\n\treturn Object.assign({}, obj1, obj2);\n}\n\n// log\nexport function log(message) {\n  console.log.call(console, `[Sentry Log] : ${message}`);\n}\n\n// warn\nexport function warn(message) {\n  console.warn.call(console, `[Sentry Warning] : ${message}`);\n}\n\n// error\nexport function error(message) {\n  console.error.call(console, `[Sentry Error] : ${message}`);\n}\n","// Sentry 类实现\n// @author muronggoudan\n// @date 2018-07-20\n\nimport {\n\treport,\n\tpolyfill,\n\tisFunction,\n\tisUndefined,\n\tisString,\n\thasKey,\n\tpathFormatter,\n  extend,\n  log,\n  warn,\n  error,\n} from './utils';\n\nimport config from './config';\n\nclass Sentry {\n\n  // 上报服务地址\n  static server = `${config.protocol}://${config.server}:${config.httpsServerPort}`;\n  // 上报接口地址\n  static path = config.path;\n  // 使能\n  static enable;\n  // 鉴权key\n  static apikey;\n\n\tconstructor (options = {}) {\n    // 配置项\n\t\tthis.options = options;\n    \n    this.mergeOptions(options);\n\t\tthis.init();\n\t}\n  \n  // 入口方法\n\tinit () {\n    \n    if (!this.enable.enable) return;\n  \n\t\tlet commonModel;\n\t\tlet httpModel;\n    let windowModel;\n\n    commonModel = new CommonModel();\n\n    this.enable.http && (httpModel = new HttpModel());\n    this.enable.window && (windowModel = new WindowModel());\n    this.enable.xhr && (new XHRModel());\n    this.enable.promise && (new PromiseModel());\n\t\t\n\t\t// window 模块安装\n\t\twindowModel && commonModel.install(\n\t\t\twindowModel.errorType,\n\t\t\twindowModel.valid,\n\t\t\twindowModel.callback\n\t\t);\n\t\t\t\n\t\t// http 模块安装\n\t\thttpModel && commonModel.install(\n\t\t\thttpModel.errorType,\n\t\t\thttpModel.valid,\n\t\t\thttpModel.callback\n    );\n\t\t\n  }\n  \n  // 合并选项\n  mergeOptions (options) {\n    \n    // @TODO 严格校验\n\n\t\t// apikey特殊处理\n\t\t// @TODO 健壮性校验\n\t\tif (!options.apikey) {\n\t\t\twarn('apikey缺失, 无法开启监控');\n\t\t\treturn;\n\t\t}\n    this.apikey = options.apikey;\n\t\n    if (options.server) {\n      this.server = options.server;\n    }\n\n    if (options.path) {\n      this.path = options.path;\n    }\n\n    if (options.module) {\n      this.enable = extend(config.sentryGlobalConfig, options.module);\n    } else {\n      this.enable = config.sentryGlobalConfig;\n    }\n  }\n\t\n\t// 安装Vue监听插件\n\tinstallVuePlugin (Vue) {\n\t\tconst vuePluginModel = new VuePluginModel();\n\t\tvuePluginModel.vuePlugin(Vue, vuePluginModel.send);\n\t}\n \t\n\t// 主动上报错误\n\tsend (message) {\n\t\tif (!message) {\n\t\t\twarn('上报失败, 参数为空');\n\t\t\treturn;\n\t\t}\n\t\n\t\t// @TODO 普通对象校验不严谨\n\t\tif (!isPlainObject(message)) {\n\t\t\twarn('上报失败, 参数必须为普通对象');\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis.commonModel.send({\n\t\t\ttype: confog.typeDoct.diy,\n\t\t\tmetaData: message,\n\t\t});\n  }\n  \n}\n\n// 公共类\nclass CommonModel {\n\t\n\tconstructor () {\n\t\t// 存放捕获器\n\t\tthis.stack = [];\n\t\tthis.addErrorEventListener();\n\t}\n\t\n\t// 安装\n\tinstall (errorType, valid, callback) {\n\t\tthis.stack.push({\n\t\t\ttype: errorType,\n\t\t\tvalid,\n\t\t\tcallback,\n\t\t});\n\t}\n\t\t\t\n\t// 错误监听\n\taddErrorEventListener () {\n\t\tconst _this = this;\n\t\t\n\t\t// DOM3级以及Opera部分错误类型不会冒泡 需要在捕获阶段获取\n\t\twindow.addEventListener('error', (errorEvent) => {\n\t\t\n\t\t\tlet i = 0,\n\t\t\tlen = _this.stack.length;\n\t\t\t\t\n\t\t\tfor (; i < len; i ++) {\n\t\t\t\tif (_this.stack[i].valid(errorEvent)) {\n\t\t\t\t\n\t\t\t\t\t_this.stack[i].callback.call(this, errorEvent);\n\t\t\t\t\t\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// 未捕获错误\n\t\t\t// Uncaught Error\n\t\t\t// @TODO 需要特殊处理\n\t\t\t\n\t\t}, true);\n\t}\n  \n  // 上报\n  send (message) {\n    // @TODO 上报频率和条数控制\n    \n    const commonMsg = this.getCommonReportMessage();\n    const url = `${Sentry.server}${Sentry.path}`;\n    message = [ message ].map((item) => {\n    \treturn extend(item, commonMsg);\n    });\n\n    return report.call(this, url, message);\n  }\n  \n  // 通用信息获取\n  getCommonReportMessage () {\n    // apikey\n    const apikey = Sentry.apikey;\n    // 版本信息\n    const version = config.version;\n    // url\n    const url = window.location ? window.location.href ? window.location.href : '' : '';\n    // 网页title\n    const title = window.document ? window.document.title ? window.document.title : '' : '';\n    // 浏览器UA\n    const userAgent = window.navigator ? window.navigator.userAgent ? window.navigator.userAgent : '' : '';\n    \n    return {\n    \tapikey,\n      title,\n      url,\n      version,\n      userAgent,\n    };\n  }\n\n}\n\n// Vue 插件模块\n// @TODO 传入到Vue类型鉴别\nclass VuePluginModel extends CommonModel {\n\n\tconstructor () {\n  \tsuper();\n  }\n\n\t// 格式化组件名称\n  formatComponentName (vm) {\n  \tif (vm.$root === vm) {\n    \treturn 'root instance';\n    }\n    \n    let name = vm._isVue ? vm.$options.name || vm.$options._componentTag : vm.name;\n    \n    return (\n    \t(name ? 'component <' + name + '>' : 'anonymous component') + \n      (vm._isVue && vm.$options.__file ? ' at ' + vm.$options.__file : '')\n    );\n  }\n  \n  // vue插件\n  vuePlugin (Vue, callback) {\n  \tconst _this = this;\n    \n    if (!Vue || !Vue.config) return;\n    \n    const _oldOnError = Vue.config.errorHandler;\n    Vue.config.errorHandler = function VueErrorHandler (error, vm, info) {\n      \n    \tlet vueMessage = {\n      \tmessage: error.message,\n        stack: error.stack,\n      };\n      \n      let _errorMessageForReport = {\n      \ttype: config.typeDict.vue,\n        vueMessage,\n        componentName: '',\n        lifecycleHook: null,\n      };\n      \n      // vm 和生命周期钩子不一定总是可用\n      if (Object.prototype.toString.call(vm) === '[object Object]') {\n      \t_errorMessageForReport.componentName = _this.formatComponentName(vm);\n      }\n      \n      if (typeof info !== 'undefined') {\n      \t_errorMessageForReport.lifecycleHook = info;\n      }\n      \n      // 兼容旧方法\n      if (typeof _oldOnError === 'function') {\n      \t_oldOnError.call(_this, error, vm, info);\n      }\n      \n      _this.send(_errorMessageForReport);\n      \n    };\n  }\n\n}\n\n// window错误模块\nclass WindowModel extends CommonModel {\n\n\tconstructor () {\n  \tsuper();\n    this.errorType = 'WindowError';\n  }\n  \n  // 目前demo校验 onerror可捕获多错误target都是window\n  // 后续健壮性继续考察\n  valid (errorEvent) {\n  \treturn errorEvent.target === window;\n  }\n  \n  callback (errorEvent) {\n  \tlet stack = {};\n    \n    if (errorEvent.error) {\n    \tstack.stack = errorEvent.error.stack || 'no stack';\n      stack.name = errorEvent.error.name || 'no name';\n    }\n    \n    const _errorMessageForReport = {\n    \ttype: config.typeDict.window,\n      colno: errorEvent.colno || 0,\n      lineno: errorEvent.lineno || 0,\n      message: errorEvent.message || 'no message',\n      stack,\n    };\n    \n    this.send(_errorMessageForReport);\n  }\n}\n\n// 资源请求模块\nclass HttpModel extends CommonModel {\n\n\tconstructor () {\n  \tsuper();\n    this.errorType = 'ResourceError';\n  }\n  \n  // 目前无法确切判断资源引用对象 但绝大部分不是window\n  // 支持img/link/script等标签\n  valid (errorEvent) {\n  \treturn errorEvent.target !== window;\n  }\n  \n  callback (errorEvent) {\n    \n  \tconst type = config.typeDict.http;\n    const path = pathFormatter(errorEvent.path).reverse().join(' > ');\n    const target = errorEvent.target.nodeName.toLocaleLowerCase();\n    const resourceUrl = errorEvent.target.src;\n    const outerHTML = errorEvent.target.outHTML;\n    \n    const _errorMessageForReport = {\n    \ttype,\n      path,\n      target,\n      resourceUrl,\n      outerHTML,\n    };\n    \n    this.send(_errorMessageForReport);\n  }\n  \n}\n\n// Promise模块\n// 未处理的catch错误\nclass PromiseModel extends CommonModel {\n  constructor () {\n    super();\n    this.install();\n  }\n\n  install () {\n    window.addEventListener('unhandledrejection', (errorEvent) => {\n      this.callback(errorEvent);\n    });\n  }\n\n  callback (errorEvent) {\n    const type = config.typeDict.promise;\n    // 拒因\n    const rejectionReason = errorEvent.reason;\n    // promise其他信息\n    const promiseDetail = {\n      returnValue: errorEvent.returnValue,\n      timeStamp: errorEvent.timeStamp,\n      type: errorEvent.type,\n    }\n\n    const _errorMessageForReport = {\n      type,\n      rejectionReason,\n      promiseDetail,\n    };\n\n    this.send(_errorMessageForReport);\n  }\n}\n\n// xhr模块\nclass XHRModel extends CommonModel {\n\n\tconstructor () {\n    super();\n    this.init();\n  }\n  \n  init () {\n  \tthis.instrumentBreadcrumbs();\n  }\n  \n  wrap (options, func, _before) {\n  \tconst _this = this;\n    \n    // 非函数单参数 返回options本身\n    if (isUndefined(func) && !isFuntion(options)) {\n    \treturn options;\n    }\n    \n    // 函数单参数 封装函数\n    if (isFunction(options)) {\n    \tfunc = options;\n      options = undefined;\n    }\n    \n    if (!isFunction(func)) {\n    \treturn func;\n    }\n    \n    // 避免二次封装\n    try {\n    \tif (func.__sentry__) {\n      \treturn func;\n      }\n      \n      if (func.__sentry_wrapper__) {\n      \treturn func.__sentry_wrapper__;\n      }\n    } catch (e) {\n    \treturn func;\n    }\n    \n    // 返回封装函数\n    function wrapped () {\n    \tlet args = [],\n        i = arguments.length,\n        // 深层封装 除非制定deep = false\n        deep = !options || (options && options.deep !== false);\n      \n      // before 钩子函数\n      if (_before && isFunction(_before)) {\n      \t_before.apply(this, arguments);\n      }\n      \n      while (i--) args[i] = deep ? _this.wrap(options, arguments[i]) : arguments[i];\n      \n      try {\n      \treturn func.apply(this, args);\n      } catch (e) {\n      \t_this._ignoreNextError();\n        \n        // 手动捕获一个异常并且发送给平台\n        // 目前函数内部细节比较多 专注捕获业务代码本身\n        throw e;\n      }\n    }\n    \n    // 代理func函数上以及原型链上多属性\n    for (var property in func) {\n    \tif (hasKey(func, property)) {\n      \twrapped[property] = func[property];\n      }\n    }\n    \n    wrapped.prototype = func.prototype;\n    \n    // 将封装函数赋值给 _sentry_wrapper__\n    func.__sentry_wrapper__ = wrapped;\n    \n    // 是否封装过多标志位\n    wrapped.__sentry__ = true;\n    // 储存原函数\n    wrapped.__orig__ = func;\n    \n    return wrapped;\n  }\n\n  captureErrorRequest (obj) {\n    // @TODO 相应时间\n    // const crumb = extend({\n    //   timestamp: now() / 1000\n    // },\n    //   obj\n    // );\n    const type = config.typeDict.xhr;\n    const method = obj.data.method;\n    const requestUrl = obj.data.url;\n    const response = obj.data.response;\n    const statusCode = obj.data.status_code;\n\n    // 过滤4|5开头的错误\n    // 需要过滤掉send接口 否则如果send接口不通 会造成无限递归\n    // @TODO 开放接口 自定义状态码\n    if (/^4|^5/.test(statusCode.toString()) && requestUrl.indexOf(config.path) === -1) {\n      this.send({\n        type,\n        method,\n        requestUrl,\n        response,\n        statusCode,\n      })\n    }\n  }\n\n  instrumentBreadcrumbs () {\n    const _this = this;\n\n    function wrapProp(prop, xhr) {\n      if (prop in xhr && isFunction([xhr[prop]])) {\n        polyfill(xhr, prop, function (orig) {\n          return _this.wrap({\n            mechanism: {\n              type: 'istrument',\n              data: {\n                function: prop,\n                handler: (orig && orig.name) || '<anonymous>',\n              }\n            }\n          },\n          orig\n          );\n        });\n      }\n    }\n\n    if ('XMLHttpRequest' in window) {\n      const xhrproto = window.XMLHttpRequest && window.XMLHttpRequest.prototype;\n      \n      // 代理open方法\n      polyfill(\n        xhrproto,\n        'open',\n        function (origOpen) {\n          return function (method, url) {\n            if (isString(url) && url.indexOf(_this._globalkey) === -1) {\n              this.__sentry_xhr_ = {\n                method,\n                url,\n                status_code: null,\n              };\n            }\n\n            return origOpen.apply(this, arguments);\n          };\n        }\n      );\n\n      // 代理send方法\n      polyfill(\n        xhrproto,\n        'send',\n        function (origSend) {\n          return function () {\n            let xhr = this;\n            function onreadystatechangeHandler() {\n              if (xhr.__sentry_xhr_ && xhr.readyState === 4) {\n                try {\n                  xhr.__sentry_xhr_.status_code = xhr.status;\n                  xhr.__sentry_xhr_.response = xhr.response;\n                } catch (e) {\n                  // do nothing\n                }\n\n                _this.captureErrorRequest({\n                  type: 'http',\n                  category: 'xhr',\n                  data: xhr.__sentry_xhr_\n                });\n              }\n            }\n\n            const props = ['onload', 'onerror', 'onprogress'];\n\n            for (let j = 0; j < props.length; j ++) {\n              wrapProp(props[j], xhr);\n            }\n\n            if ('onreadystatechange' in xhr && isFunction(xhr.onreadystatechange)) {\n              polyfill(\n                xhr,\n                'onreadystatechange',\n                function (orig) {\n                  return _this.wrap({\n                    mechanism: {\n                      type: 'instrument',\n                      data: {\n                        function: 'onreadystatechange',\n                        handler: (orig && orig.name) || '<anonymous>',\n                      }\n                    }\n                  },\n                  orig,\n                  onreadystatechangeHandler\n                  );\n                }\n              );\n            } else {\n              xhr.onreadystatechange = onreadystatechangeHandler;\n            }\n\n            return origSend.apply(this, arguments);\n          };\n        }\n      ) \n    }\n  }\n}\n \nexport {\n  Sentry\n}\n"],"sourceRoot":""}